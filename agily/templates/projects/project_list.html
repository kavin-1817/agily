{% extends 'base.html' %}
{% load text_extras %}

{% block page_title %}Projects{% endblock %}

{% block content %}
<div class="container">
  <div class="section">
    <div class="level">
      <div class="level-left">
        <h2 class="title">Projects</h2>
      </div>
      <div class="level-right">
        {% if user.is_superuser %}
        <a class="button is-link" href="{% url 'project-add'%}">
            <span class="icon is-small"><i class="fas fa-plus"></i></span>
            <small>Add project</small>
          </a>
        {% endif %}
      </div>
    </div>
    <table class="table project-table is-bordered is-striped is-hoverable is-fullwidth">
      <thead>
        <tr>
          <th class="id-cell">ID</th>
          <th class="title-cell">Name</th>
          <th class="desc-cell">Description</th>
          <th>Project Admin</th>
          <th style="display:none"></th>
          <th style="display:none"></th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% if projects %}
          {% for project in projects %}
          <tr>
            <td class="id-cell">{{ project.id }}</td>
            <td class="title-cell">
              <a href="{% url 'project-detail' pk=project.id %}">
                <b>{{ project.name|truncate_title:45 }}</b>
              </a>
            </td>
            <td class="desc-cell" style=" word-break: break-word; max-width: 300px;">
              {{ project.description|default:''|truncate_desc:60 }}
            </td>
            <td>{{ project.project_admin|default:"Not assigned" }}</td>
            <td style="display:none">{{ project.created_at|date:'Y-m-d' }}</td>
            <td style="display:none">{{ project.updated_at|date:'Y-m-d' }}</td>
            <td>
              <a href="{% url 'project-detail' pk=project.id %}" title="View" style="width:2.5em; height:2.5em; background:#8FA01F !important; color:white !important; border-radius:6px; display:inline-flex; align-items:center; justify-content:center; border:none; margin-right:0.3em; text-decoration:none;">
                <i class="fas fa-eye" style="color:white;"></i>
              </a>
              {% if user.is_superuser %}
                <a href="{% url 'project-edit' pk=project.id %}?next={{ encoded_url }}" title="Edit" style="width:2.5em; height:2.5em; background:#1B4F72; color:white; border-radius:6px; display:inline-flex; align-items:center; justify-content:center; border:none; margin-right:0.3em; text-decoration:none;">
                  <i class="fas fa-edit" style="color:white;"></i>
                </a>
                <form method="post" action="{% url 'project-delete' project.id %}" style="display:inline;">
                  {% csrf_token %}
                  <button type="submit" name="remove" value="yes" title="Remove" onclick="return confirm('Are you sure you want to remove this project?');" style="width:2.5em; height:2.5em; background:#943126; color:white; border-radius:6px; display:inline-flex; align-items:center; justify-content:center; border:none; padding:0;">
                    <i class="fas fa-trash" style="color:white;"></i>
                  </button>
                </form>
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr><td colspan="6">No projects found for this workspace.</td></tr>
        {% endif %}
      </tbody>
    </table>
    <br/>
    {% include "paginator.html" %}
  </div>
</div>
{% endblock %}