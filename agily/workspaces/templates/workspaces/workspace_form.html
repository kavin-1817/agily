{% extends 'base.html' %}

{% block object_list_url %}{% url 'workspaces:workspace-list' %}{% endblock %}

{% block content %}
	<nav class="level">
		<!-- Left side -->
		<div class="level-left">
			<nav class="breadcrumb is-large" aria-label="breadcrumbs">
				<ul>
          <li><a href="{% url 'workspaces:workspace-list' %}">Workspaces</a></li>
          <li class="is-active">
            <a href="#" aria-current="page">
              {% if object %}Editing {{ object.title }}{% else %}Create a Workspace{% endif %}
            </a>
          </li>
				</ul>
			</nav>
		</div>

		<!-- Right side -->
		<div class="level-right">
			<div class="level-item">
			</div>
		</div>
	</nav>

  {% if not user.is_superuser %}
    <div class="notification is-danger">
      <p><strong>Access Denied:</strong> Only superusers can create workspaces. Please contact your administrator to create a workspace for you.</p>
    </div>
  {% else %}
    {% if not object %}
      <div class="notification is-info">
        <p><strong>Superuser Workspace Creation:</strong> You can create new workspaces here. Regular users will need to be added as members by you via the admin panel.</p>
      </div>
    {% endif %}

    {% if form.non_field_errors %}
      <div class="notification is-danger">
        <button class="delete" onclick="this.parentElement.remove()"></button>
        {% for error in form.non_field_errors %}
          <p>{{ error }}</p>
        {% endfor %}
      </div>
    {% endif %}
    
    <div class="container">
      <div class="card" style="max-width: 800px; margin: 2em auto; box-shadow: 0 4px 24px 0 rgba(71,85,105,0.10); border-radius: 16px;">
        <div class="card-content" style="padding: 2.5em 2em;">
          <form method="post">{% csrf_token %}
            {% for hidden in form.hidden_fields %}
              {{ hidden }}
            {% endfor %}
            {% for field in form.visible_fields %}
              {% if field.name == 'description' %}
                <div class="field" style="margin-bottom: 1.5em; width: 100%;">
                  <div style="display: flex; align-items: flex-start;">
                    <div style="width: 200px; text-align: right; padding-right: 15px; flex-shrink: 0; padding-top: 8px;">
                      <label class="label" for="id_{{ field.name }}" style="font-weight: 500; margin-bottom: 0; font-size: 1rem;">
                        {{ field.label }}:
                      </label>
                    </div>
                    <div style="flex: 1; min-width: 500px;">
                      <div class="control">
                        <textarea name="{{ field.html_name }}" id="id_{{ field.name }}" maxlength="300"
                          oninput="updateCharCount(this, 'desc-count-{{ field.name }}')" rows="7"
                          style="width:100%; resize:vertical; font-size:1.1em; padding:1em; border-radius:8px; border:1.5px solid #475569; background:#f8fafc; min-height: 8em; max-width: 100%;">{{ field.value|default_if_none:'' }}</textarea>
                      </div>
                      <div>
                        <span id="desc-count-{{ field.name }}">0</span>/300 characters
                      </div>
                      {% if field.errors %}
                        <p class="help is-danger">{{ field.errors }}</p>
                      {% endif %}
                      <p class="help">Max 300 characters.</p>
                    </div>
                  </div>
                </div>
              {% else %}
                <div class="field" style="margin-bottom: 1.5em; width: 100%;">
                  <div style="display: flex; align-items: flex-start;">
                    <div style="width: 200px; text-align: right; padding-right: 15px; flex-shrink: 0; padding-top: 8px;">
                      <label class="label" for="id_{{ field.name }}" style="font-weight: 500; margin-bottom: 0; font-size: 1rem;">
                        {{ field.label }}{% if field.name == 'solution' %} (for developers){% endif %}:
                      </label>
                    </div>
                    <div style="flex: 1; min-width: 500px;">
                      <div class="control">
                        {{ field }}
                      </div>
                      {% if field.errors %}
                        <p class="help is-danger">{{ field.errors }}</p>
                      {% endif %}
                      {% if field.help_text %}
                        <p class="help">{{ field.help_text|safe }}</p>
                      {% endif %}
                    </div>
                  </div>
                </div>
              {% endif %}
            {% endfor %}
            <div class="field" style="margin-top: 2em;">
              <div style="display: flex; justify-content: center; align-items: center; gap: 1.5em;">
                <button type="submit" class="button is-primary" style="border-radius: 8px; min-width: 120px;">{% if object %}Update{% else %}Create{% endif %} Workspace</button>
                <a href="{% url 'workspaces:workspace-list' current_workspace %}" class="button is-light" style="border-radius: 8px; min-width: 120px;">Cancel</a>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}
